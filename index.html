<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HNIT PAN INDIA INVENTORY DASHBOARD</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h2 { text-align: center; }
    .summary { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 20px; }
    .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; width: 180px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { padding: 8px 12px; border: 1px solid #ccc; text-align: left; }
    th { background: #333; color: white; }
    td input { width: 100%; border: none; background: transparent; }
    .btn { padding: 6px 12px; margin: 4px; cursor: pointer; }
    #loginScreen { text-align: center; margin-top: 100px; }
    #mainContent { display: none; }
    select { padding: 5px; margin: 5px; }
    .readonly input { background: #eee; pointer-events: none; }
    .readonly button { display: none; }
  </style>
</head>
<body>
<div id="loginScreen">
  <h2>üîê Enter Password to Access Inventory</h2>
  <input type="password" id="password" placeholder="Enter Password" />
  <button onclick="checkPassword()">Login</button>
</div>

<div id="mainContent">
  <h2>üì¶ HNIT PAN INDIA INVENTORY DASHBOARD</h2>
  <div class="summary" id="summaryCards"></div>

  <div style="text-align:center">
    Filter:
    <select id="locationFilter"></select>
    <select id="workstationFilter"></select>
    <select id="stateFilter"></select>
    <button onclick="clearFilters()">Clear Filters</button>
  </div>

  <div style="text-align:center; margin: 10px 0;" id="editControls">
    <button onclick="addRow()" class="btn">‚ûï Add Item</button>
    <button onclick="exportCSV()" class="btn">üíæ Export CSV</button>
  </div>

  <table id="inventoryTable"></table>
</div>

<script>
const DATA_URL = "https://raw.githubusercontent.com/Rohit007r/hnit-inventory/main/inventory.csv";
const EDIT_PASSWORD = "HNIT@@##1231";
const VIEW_PASSWORD = "Er&0de@12$";

let data = [], headers = [];
let readOnly = false;

function checkPassword() {
  const pwd = document.getElementById("password").value;
  if (pwd === EDIT_PASSWORD) {
    readOnly = false;
    proceed();
  } else if (pwd === VIEW_PASSWORD) {
    readOnly = true;
    proceed();
  } else {
    alert("‚ùå Incorrect Password");
  }
}

function proceed() {
  document.getElementById("loginScreen").style.display = "none";
  document.getElementById("mainContent").style.display = "block";
  if (readOnly) document.getElementById("editControls").style.display = "none";
  loadCSV();
}

function loadCSV() {
  Papa.parse(DATA_URL, {
    download: true,
    header: true,
    complete: (results) => {
      data = results.data.filter(r => Object.values(r).some(v => v));
      headers = Object.keys(data[0]);
      renderSummary();
      fillFilters();
      renderTable();
    }
  });
}

function renderSummary() {
  const loc = document.getElementById("locationFilter").value;
  const ws = document.getElementById("workstationFilter").value;
  const state = document.getElementById("stateFilter").value;

  const filtered = data.filter(row =>
    (!loc || row["LOCATION"] === loc) &&
    (!ws || row["WORKSTATION"] === ws) &&
    (!state || row["STATE"] === state)
  );

  const total = filtered.length;

  const stateCounts = {};
  filtered.forEach(row => {
    const st = row["STATE"];
    if (st) {
      stateCounts[st] = (stateCounts[st] || 0) + 1;
    }
  });

  const stateCards = Object.entries(stateCounts).map(([state, count]) => `
    <div class="card"><h3>${state}</h3><p>${count} items</p></div>
  `).join('');

  document.getElementById("summaryCards").innerHTML = `
    <div class="card"><h3>Total Items</h3><p>${total}</p></div>
    ${stateCards}
  `;
}

function fillFilters() {
  fillDropdown("locationFilter", "LOCATION");
  fillDropdown("workstationFilter", "WORKSTATION");
  fillDropdown("stateFilter", "STATE");
}

function fillDropdown(id, key) {
  const values = [...new Set(data.map(d => d[key]))].filter(Boolean);
  const dropdown = document.getElementById(id);
  dropdown.innerHTML = `<option value="">-- ${key} --</option>` +
    values.map(v => `<option value="${v}">${v}</option>`).join('');
  dropdown.onchange = () => {
    renderSummary();
    renderTable();
  };
}

function clearFilters() {
  document.getElementById("locationFilter").value = "";
  document.getElementById("workstationFilter").value = "";
  document.getElementById("stateFilter").value = "";
  renderSummary();
  renderTable();
}

function renderTable() {
  const loc = document.getElementById("locationFilter").value;
  const ws = document.getElementById("workstationFilter").value;
  const state = document.getElementById("stateFilter").value;

  const filtered = data.filter(row =>
    (!loc || row["LOCATION"] === loc) &&
    (!ws || row["WORKSTATION"] === ws) &&
    (!state || row["STATE"] === state)
  );

  const table = document.getElementById("inventoryTable");
  table.innerHTML = "";
  const thead = document.createElement("thead");
  const headerRow = document.createElement("tr");
  headers.forEach(h => {
    const th = document.createElement("th"); th.innerText = h; headerRow.appendChild(th);
  });
  if (!readOnly) headerRow.innerHTML += "<th>Actions</th>";
  thead.appendChild(headerRow); table.appendChild(thead);

  const tbody = document.createElement("tbody");
  filtered.forEach((row, i) => {
    const tr = document.createElement("tr");
    headers.forEach(h => {
      const td = document.createElement("td");
      td.innerHTML = readOnly
        ? `<input value="${row[h] || ""}" readonly>`
        : `<input value="${row[h] || ""}" onchange="data[${i}]['${h}'] = this.value">`;
      tr.appendChild(td);
    });
    if (!readOnly) {
      const del = document.createElement("td");
      del.innerHTML = `<button onclick="deleteRow(${i})">‚ùå</button>`;
      tr.appendChild(del);
    }
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
}

function addRow() {
  const newRow = {};
  headers.forEach(h => newRow[h] = "");
  data.push(newRow);
  renderSummary();
  renderTable();
}

function deleteRow(i) {
  if (confirm("Delete this row?")) {
    data.splice(i, 1);
    renderSummary();
    renderTable();
  }
}

function exportCSV() {
  const csv = Papa.unparse(data);
  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  saveAs(blob, "updated_inventory.csv");
}
</script>
</body>
</html>
